{"componentChunkName":"component---src-templates-post-jsx","path":"/M1-EC2-Docker-ErrorHandling/","result":{"data":{"site":{"siteMetadata":{"title":"seokulee"}},"markdownRemark":{"id":"e0a64803-e72e-5e3c-87e8-37fc68741b3b","excerpt":"환경 로컬환경 M1 MacBook Pro Docker version 27.2.0 Dockerfile Image: node:14-alpine EC2환경 Amazon Linux Docker version  25.0.5 64bit x86 / arm Option t2.micro 발생한 에러 로컬환경에서 빌드한 이미지를 Docker Hub에 push 한 뒤 EC2…","html":"<h2 id=\"환경\" style=\"position:relative;\"><a href=\"#%ED%99%98%EA%B2%BD\" aria-label=\"환경 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>환경</h2>\n<p>로컬환경</p>\n<ul>\n<li>M1 MacBook Pro</li>\n<li>Docker version 27.2.0</li>\n<li>Dockerfile Image: node:14-alpine</li>\n</ul>\n<p>EC2환경</p>\n<ul>\n<li>Amazon Linux</li>\n<li>Docker version  25.0.5</li>\n<li>64bit x86 / arm Option</li>\n<li>t2.micro</li>\n</ul>\n<h2 id=\"발생한-에러\" style=\"position:relative;\"><a href=\"#%EB%B0%9C%EC%83%9D%ED%95%9C-%EC%97%90%EB%9F%AC\" aria-label=\"발생한 에러 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>발생한 에러</h2>\n<p>로컬환경에서 빌드한 이미지를 Docker Hub에 push 한 뒤 EC2에 컨테이너를 수동으로 배포하는데 다음과 같은 error가 발생했습니다.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/1262d1c9d3fa844a653b790fbd0752f5/0a739/ERROR_LOG.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 21.176470588235293%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAlklEQVR42o2PSQ6DMBAEeU1C2My+GZnFYFBCFin/f0vHM5GiHDmUeqYPNbbTz3covaNRBrLf0KoVZashsg5JoRClLbyohBvkh3CW6xvj8gCJq27h8hIWnGc/w8lL4do8LDR/wlJqlpCQXkXQTFB/BGcyTxbq7YXRzv28Y7C7mm7f79sjWT1A5BJBXDNh0jC+qH5dEDecH0y6gRsw46nWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='Error Log' title='' src='/static/1262d1c9d3fa844a653b790fbd0752f5/ca1dc/ERROR_LOG.png' srcset='/static/1262d1c9d3fa844a653b790fbd0752f5/e7570/ERROR_LOG.png 170w,\n/static/1262d1c9d3fa844a653b790fbd0752f5/f46e7/ERROR_LOG.png 340w,\n/static/1262d1c9d3fa844a653b790fbd0752f5/ca1dc/ERROR_LOG.png 680w,\n/static/1262d1c9d3fa844a653b790fbd0752f5/02d09/ERROR_LOG.png 1020w,\n/static/1262d1c9d3fa844a653b790fbd0752f5/9d567/ERROR_LOG.png 1360w,\n/static/1262d1c9d3fa844a653b790fbd0752f5/0a739/ERROR_LOG.png 2638w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>Error Log</figcaption>\n  </figure></p>\n<p><strong>WARNING: The requested image's platform (linux/arm64/v8) does not match the detected host platform (linux/amd64/v3) and no specific platform was requested</strong></p>\n<p>WARNING: The requested image's platform does not match the detected host platform and no specific platform was requested</p>\n<h2 id=\"해결-방법\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\" aria-label=\"해결 방법 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>해결 방법</h2>\n<p>해당 오류는 M1 맥북으로 빌드한 이미지 플랫폼(linux/arm64/v8)과 제가 선택한 EC2의 플랫폼(linux/amd64)이 맞지 않아 발생했습니다.</p>\n<p>이를 해결하기 위해 이미지 빌드 시 <code class=\"language-text\">--platform</code> 옵션을 사용하여 빌드했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">docker</span> build <span class=\"token parameter variable\">--platform</span> linux/amd64 <span class=\"token parameter variable\">-t</span> <span class=\"token punctuation\">[</span>ImageName<span class=\"token punctuation\">]</span> <span class=\"token builtin class-name\">.</span></code></pre></div>\n<h2 id=\"추가로-생각해본-것\" style=\"position:relative;\"><a href=\"#%EC%B6%94%EA%B0%80%EB%A1%9C-%EC%83%9D%EA%B0%81%ED%95%B4%EB%B3%B8-%EA%B2%83\" aria-label=\"추가로 생각해본 것 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>추가로 생각해본 것</h2>\n<p>지금은 EC2의 Error Log에 맞게 플랫폼 옵션을 사용했지만 Multi-Platform을 지원하기 위해 다음과 같이 빌드하기도 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">docker</span> build <span class=\"token parameter variable\">--platform</span> linux/amd64, linux/arm64 <span class=\"token builtin class-name\">.</span></code></pre></div>\n<p>로컬환경에서 빌드 -> Docker Hub에 push -> EC2에서 pull 받아 다시 배포했습니다.</p>\n<h2 id=\"주의할-점\" style=\"position:relative;\"><a href=\"#%EC%A3%BC%EC%9D%98%ED%95%A0-%EC%A0%90\" aria-label=\"주의할 점 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>주의할 점</h2>\n<p>도커는 컨테이너 실행 시 도커 명령어를 실행한 로컬에서 먼저 이미지를 찾고, 없으면 Docker Hub에서 찾습니다. 이 말인즉슨 이미 로컬에 이미지가 존재한다면 기존 이미지를 사용할 것입니다.\n그래서 기존 이미지를 지운 다음 다시 실행했습니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/f75a7c7ff5d189d1efed9de5b27d900f/0a739/IMAGE_2.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 33.529411764705884%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA6klEQVR42o2R6W6CUBCFfZmqRQUKLkgviOwgINa4Jn3/xzidOwRT4xJ+nJy7fpkz01tHFfykvmkVlhDrHK6/YVlOhLntQzMF9KlDElDUOYZjkzR9UM8NCkT5Hml5REyeFAf2jPZJeUC+PfO9hCjqgv1zMnsKY6CsKqtOBDjR5wuvN+TF7sqwav/LZ/LxYGSyXsEY6FFE719sLyqxdGMIL4MlQoobYLb031Z1B5Q9lD37JkAbp6nEQF8x8DHUyb86wRgYZj88CNnLFthK7se6hZG26A7kqHGNIK3h0FQbNVO2Vyk0mqxq2J2BfxLC5xqI1c3RAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='IMAGE 2' title='' src='/static/f75a7c7ff5d189d1efed9de5b27d900f/ca1dc/IMAGE_2.png' srcset='/static/f75a7c7ff5d189d1efed9de5b27d900f/e7570/IMAGE_2.png 170w,\n/static/f75a7c7ff5d189d1efed9de5b27d900f/f46e7/IMAGE_2.png 340w,\n/static/f75a7c7ff5d189d1efed9de5b27d900f/ca1dc/IMAGE_2.png 680w,\n/static/f75a7c7ff5d189d1efed9de5b27d900f/02d09/IMAGE_2.png 1020w,\n/static/f75a7c7ff5d189d1efed9de5b27d900f/9d567/IMAGE_2.png 1360w,\n/static/f75a7c7ff5d189d1efed9de5b27d900f/0a739/IMAGE_2.png 2638w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>[REF]</p>\n<p><a href=\"https://docs.docker.com/build/building/multi-platform/\">docker docs</a></p>","frontmatter":{"title":"M1 맥북으로 EC2 배포 시 오류","date":"October 13, 2024","update":"October 13, 2024","tags":["Docker","AWS","EC2","삽질"],"series":null},"fields":{"slug":"/M1-EC2-Docker-ErrorHandling/","readingTime":{"minutes":2.025}}},"seriesList":{"edges":[{"node":{"id":"e0a64803-e72e-5e3c-87e8-37fc68741b3b","fields":{"slug":"/M1-EC2-Docker-ErrorHandling/"},"frontmatter":{"title":"M1 맥북으로 EC2 배포 시 오류"}}},{"node":{"id":"10889af7-9102-59f8-826c-0d35a212c894","fields":{"slug":"/about/"},"frontmatter":{"title":"데이터 엔지니어 Seoku 입니다. ✋"}}}]},"previous":null,"next":null},"pageContext":{"id":"e0a64803-e72e-5e3c-87e8-37fc68741b3b","series":null,"previousPostId":null,"nextPostId":null}},"staticQueryHashes":[],"slicesMap":{}}